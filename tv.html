<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="BBINCOTV"/>

    <title>BBINCOTV</title>
    <?xml version="1.0" encoding="UTF-8"?>
        <widget xmlns:tizen="http://tizen.org/ns/widgets" xmlns="http://www.w3.org/ns/widgets" id="http://172.15.0.15/BBINCO/TV/" version="0.2.1" viewmodes="maximized">
            <tizen:application id="87yCAs7xPK.bbinco" package="87yCAs7xPK" required_version="2.3"/>
            <content src="index.html"/>
            <feature name="http://tizen.org/feature/screen.size.normal.1080.1920"/>
            <feature name="http://tizen.org/feature/screen.size.all"/>
            <feature name="http://www.samsungdforum.com/feature/Keyboard"/>
            <icon src="icon.png"/>
            <tizen:metadata key="http://samsung.com/tv/metadata/prelaunch.support" value="true"/>
            <name>bbinco</name>
            <tizen:privilege name="http://developer.samsung.com/privilege/productinfo"/>
            <tizen:privilege name="http://tizen.org/privilege/tv.inputdevice"/>
            <tizen:privilege name="http://tizen.org/privilege/mediacapture"/>
            <tizen:privilege name="http://developer.samsung.com/privilege/b2bcontrol"/>
            <tizen:privilege name="http://developer.samsung.com/privilege/b2bdoc"/>
            <tizen:privilege name="http://tizen.org/privilege/application.launch"/>
            <tizen:profile name="tv-samsung"/>
            <tizen:setting screen-orientation="landscape" context-menu="enable" background-support="disable" encryption="disable" install-location="auto" hwkey-event="enable"/>
        </widget>
    </xml>

    <!-- Script Files -->
    <script type='text/javascript' src='$B2BAPIS/b2bapis/b2bapis.js'></script>
    <script type='text/javascript' src='$MANAGER_WIDGET/Common/af/2.0.0/loader.js'></script>
    <script type="text/javascript" src="$WEBAPIS/webapis/webapis.js"></script>
    <script type='text/javascript' src='./Views/Vendors/Samsung/Server.js'></script> <!-- ACTUALIZAR IP SERVIDOR! -->

    <script type='text/javascript' src='./Views/Libraries/jquery-1.12.3.min.js'></script>
</head>
<body>
    <div class='GeneralBox' id='GeneralBox'></div>
</body>
<footer></footer>
<script>
    var MACAddress  = 'fc:03:9f:5c:98:ed';

    var InfoDevice = [];
    var TemplateSource = '';
    var Data = '';

    var CurrentModule = '',
        ModuleId      = '',
        IndexLogo     = '';

    var head = document.getElementsByTagName('head').item(0),
        footer = document.getElementsByTagName('footer').item(0),
        script = '',
        link = '',
        i = 0;


    if (window.tizen !== undefined) {
        var b2bcontrol = window.b2bapis.b2bcontrol;

        try {
            //MACAddress = b2bcontrol.getMACAddress();
            MACAddress  = 'fc:03:9f:5c:98:ed';
        } catch (e) {
            //'[getMACAddress] call syncFunction exception [' + e.code + '] name: ' + e.name + ' message: ' + e.message);
        }
    }

    $.ajax({
        type: 'POST',
        url: 'http://'+ServerIp+'/BBINCO/TV/Core/Controllers/Index.php',
        async: false,
        data: {
            Option      : 'LOAD',
            MacAddress  : MACAddress,
        },
        success: function (response) {
            var InfoDevice = $.parseJSON(response);
            ModuleId = InfoDevice['ModuleId'];
            CurrentModule = InfoDevice['ModuleName'];

            InfoDevice = null;

            GetContents();
        }
    });

    function GetContents() {
        $.ajax({
            method: 'POST',
            url: 'http://' + ServerIp + '/BBINCO/TV/tvContent.php',
            async: false,
            data: {
                MacAddress: MACAddress,
                ModuleId: ModuleId,
                CurrentModule: CurrentModule
            },
            success: function (response) {
                Data = $.parseJSON(response);

                IndexLogo = Data['Variables'][0].IndexLogo;

                TemplateSource = 'http://' + ServerIp + '/BBINCO/TV/'+Data['Variables'][0].Template;

                GetTemplateContent();
            }
        });
    }

    function GetTemplateContent(){
        $.ajax({
            type: 'POST',
            url: TemplateSource,
            async: false,
            success: function (response) {
                document.getElementById('GeneralBox').innerHTML = '<div id="DebugText"></div> '+response;

                console.log('SE CREAO EL CONTENIDO HTML');
            }
        });

        SetScriptsStyles();
    }

    function SetScriptsStyles(){
        for(i = 0; i < Data['ScriptsHeader'].length; i++){
            script = document.createElement('script');
            script.setAttribute('type', 'text/javascript');
            script.setAttribute('src', Data['ScriptsHeader'][i]);
            head.appendChild(script);
        }

        i = 0;

        for(i = 0; i < Data['Styles'].length; i++){
            link = document.createElement('link');
            link.type = 'text/css';
            link.rel = 'stylesheet';
            link.href = Data['Styles'][i];

            head.appendChild(link);
        }
        i = 0;
    }

    function SetFooterScripts(){
        for(i = 0; i < Data['ScriptsFooter'].length; i++){
            script = document.createElement('script');
            script.setAttribute('type', 'text/javascript');
            script.setAttribute('src', Data['ScriptsFooter'][i]);
            console.log(Data['ScriptsFooter'][i]);
            footer.appendChild(script);

            //i++;
            // if(i >= Data['ScriptsFooter'].length){
            //     clearInterval(FooterInterval);
            //     console.log('END SCRIPTS');
            // }
        }
    }

    //var FooterInterval = setInterval(function(){ SetFooterScripts(); }, 900);

    setTimeout(function(){ SetFooterScripts(); }, 900);
</script>
</html>